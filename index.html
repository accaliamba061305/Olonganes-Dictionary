<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>English ‚Äì Olonganes Dictionary</title>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.min.js"></script>
  <style>
    :root { --bg: #ffffff; --text: #000000; --panel-bg: #f8f8f8; --border: #333; }
    body { margin: 0; padding: 20px; font-family: system-ui, sans-serif; line-height: 1.6; background: var(--bg); color: var(--text); transition: all 0.3s ease; }
    .container { max-width: 720px; margin: 0 auto; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    h1 { margin: 0; font-size: 2rem; }
    .search-bar { position: relative; display: flex; gap: 10px; margin-bottom: 24px; align-items: center; }
    .direction-select { padding: 10px; font-size: 1rem; border: 1px solid var(--border); border-radius: 8px; background: var(--panel-bg); color: var(--text); }
    input#search { flex: 1; padding: 12px 16px; font-size: 1.1rem; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); }
    button { padding: 12px 20px; font-size: 1rem; cursor: pointer; border-radius: 8px; border: 1px solid var(--border); background: var(--panel-bg); color: var(--text); }
    button:hover { background: rgba(0,0,0,0.08); }
    #result { margin-top: 16px; }
    .entry { background: var(--panel-bg); padding: 20px; border-radius: 10px; border: 1px solid var(--border); position: relative; }
    .bookmark-btn { position: absolute; top: 20px; right: 20px; font-size: 1.8rem; background: transparent; border: none; cursor: pointer; color: #ccc; }
    .bookmark-btn.bookmarked { color: gold; }
    .panel { display: none; margin-top: 16px; padding: 20px; background: var(--panel-bg); border: 2px solid var(--border); border-radius: 10px; animation: fadeIn 0.25s ease; }
    .settings-btn { font-size: 1.8rem; background: transparent; border: none; cursor: pointer; padding: 8px; color: var(--text); }
    body.contrast-bow { --bg: #ffffff; --text: #000000; --panel-bg: #f0f0f0; --border: #333; }
    body.contrast-wob { --bg: #000000; --text: #ffffff; --panel-bg: #111111; --border: #ccc; }
    body.contrast-yob { --bg: #000000; --text: #ffff00; --panel-bg: #1a1a00; --border: #ffff00; }
    body.size-standard { font-size: 16px; }
    body.size-large { font-size: 19px; }
    body.size-xlarge { font-size: 22px; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @media (max-width: 500px) { .search-bar { flex-direction: column; } button { width: 100%; } .direction-select { width: 100%; } }

    .suggestions, #historyPanel, #bookmarkPanel {
      position: absolute;
      background: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      max-height: 250px;
      overflow-y: auto;
      z-index: 10;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: none;
    }
    .suggestions { width: calc(100% - 80px); }
    .suggestion-item, .history-item, .bookmark-item { padding: 10px 16px; cursor: pointer; }
    .suggestion-item:hover, .history-item:hover, .bookmark-item:hover { background: rgba(0,0,0,0.1); }
    .highlight { font-weight: bold; background: rgba(255,255,0,0.3); }
    #historyPanel, #bookmarkPanel { right: 20px; top: 60px; width: 280px; padding: 16px; }
    #historyList, #bookmarkList { max-height: 200px; overflow-y: auto; }
    #loading { text-align: center; font-size: 1.2rem; color: orange; margin: 20px 0; }
  </style>
</head>
<body class="contrast-bow size-standard">

  <div class="container">

    <header>
      <h1>English ‚Üí Olonganes</h1>
      <div style="display: flex; gap: 8px;">
        <button class="settings-btn" onclick="toggleSettings()" title="Settings">‚öôÔ∏è</button>
        <button class="settings-btn" onclick="toggleHistory()" title="Recent Searches">üìú</button>
        <button class="settings-btn" onclick="toggleBookmarks()" title="Bookmarks">‚≠ê</button>
      </div>
    </header>

    <div id="loading">ƒêang t·∫£i t·ª´ ƒëi·ªÉn... (c√≥ th·ªÉ m·∫•t v√†i gi√¢y n·∫øu t·ª´ ƒëi·ªÉn l·ªõn)</div>

    <div class="search-bar" style="display: none;" id="searchBar">
      <select id="searchDirection" class="direction-select">
        <option value="en-to-ol">English ‚Üí Olonganes</option>
        <option value="ol-to-en">Olonganes ‚Üí English</option>
      </select>
      <div style="position: relative; flex: 1;">
        <input type="text" id="search" placeholder="Enter word..." autocomplete="off">
        <div id="suggestions" class="suggestions"></div>
      </div>
      <button onclick="searchWord()">Search</button>
    </div>

    <div id="result"></div>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="panel">
      <h2>Settings</h2>
      <h3>Contrast Mode</h3>
      <button onclick="setContrast('contrast-bow')">Black on White</button>
      <button onclick="setContrast('contrast-wob')">White on Black</button>
      <button onclick="setContrast('contrast-yob')">Yellow on Black</button>
      <h3>Text Size</h3>
      <button onclick="setSize('size-standard')">Standard</button>
      <button onclick="setSize('size-large')">Large</button>
      <button onclick="setSize('size-xlarge')">Extra Large</button>
      <br><br>
      <button onclick="toggleSettings()">Close</button>
    </div>

    <!-- History Panel -->
    <div id="historyPanel" class="panel">
      <h3>Recent Searches</h3>
      <div id="historyList"></div>
      <br>
      <button onclick="clearHistory()" style="background: #ff4d4d; color: white;">Clear History</button>
      <br><br>
      <button onclick="toggleHistory()">Close</button>
    </div>

    <!-- Bookmark Panel -->
    <div id="bookmarkPanel" class="panel">
      <h3>Bookmarks</h3>
      <div id="bookmarkList"></div>
      <br>
      <button onclick="clearBookmarks()" style="background: #ff4d4d; color: white;">Clear Bookmarks</button>
      <br><br>
      <button onclick="toggleBookmarks()">Close</button>
    </div>

  </div>

  <script>
    let dictionary = [];
    let fuseEn, fuseOl;

    async function loadDictionary() {
      try {
        const response = await fetch('dictionary.json');
        if (!response.ok) throw new Error('Kh√¥ng t√¨m th·∫•y dictionary.json');
        dictionary = await response.json();

        // Kh·ªüi t·∫°o Fuse cho hai h∆∞·ªõng
        fuseEn = new Fuse(dictionary, { keys: ['english'], threshold: 0.4, includeScore: true, shouldSort: true });
        fuseOl = new Fuse(dictionary, { keys: ['olonganes'], threshold: 0.4, includeScore: true, shouldSort: true });

        document.getElementById('loading').style.display = 'none';
        document.getElementById('searchBar').style.display = 'flex';
      } catch (error) {
        console.error(error);
        document.getElementById('loading').innerHTML = '<p style="color: tomato;">L·ªói t·∫£i t·ª´ ƒëi·ªÉn. S·ª≠ d·ª•ng t·ª´ ƒëi·ªÉn m·∫´u nh·ªè.</p>';
        // Fallback dictionary m·∫´u
        dictionary = [
          { english: "hello", olonganes: "sturelik", definition: "A universal greeting...", synonyms: "Bogoda, Stu, Sturelikaniy", example: "Sturelik! Kome sontu vera?" },
          { english: "goodbye", olonganes: "blyenata", definition: "A short-term farewell...", synonyms: "Blyeneti, Blavra, Bleva, Phandias", example: "Blyenata! Metep schkol." },
          { english: "i", olonganes: "miy", definition: "First-person singular...", synonyms: "Miyla, Misi", example: "Miy sontu khluppi." }
        ];
        fuseEn = new Fuse(dictionary, { keys: ['english'], threshold: 0.4, includeScore: true, shouldSort: true });
        fuseOl = new Fuse(dictionary, { keys: ['olonganes'], threshold: 0.4, includeScore: true, shouldSort: true });
        document.getElementById('searchBar').style.display = 'flex';
      }
    }

    function getFuse() {
      const direction = document.getElementById('searchDirection').value;
      return direction === 'en-to-ol' ? fuseEn : fuseOl;
    }

    function findEntry(query) {
      query = query.trim();
      if (!query) return null;

      const direction = document.getElementById('searchDirection').value;
      const key = direction === 'en-to-ol' ? 'english' : 'olonganes';
      const exact = dictionary.find(w => w[key].toLowerCase() === query.toLowerCase());
      if (exact) return { entry: exact, exact: true };

      const fuse = getFuse();
      let results = fuse.search(query);
      if (results.length > 0) {
        return { entry: results[0].item, exact: false };
      }
      return null;
    }

    function renderEntry(entry) {
      const isBookmarked = bookmarks.some(b => b.english === entry.english);
      return `<div class="entry">
        <button class="bookmark-btn ${isBookmarked ? 'bookmarked' : ''}" onclick="toggleBookmark('${entry.english}')">‚òÖ</button>
        <h2>${entry.olonganes}</h2>
        <p><b>English:</b> ${entry.english}</p>
        <p><b>Definition:</b> ${entry.definition}</p>
        <p><b>Synonyms:</b> ${entry.synonyms}</p>
        <p><b>Example:</b> ${entry.example}</p>
      </div>`;
    }

    function searchWord() {
      const input = document.getElementById("search").value.trim();
      const resultDiv = document.getElementById("result");

      if (!input) {
        resultDiv.innerHTML = "<p>Dumbshit, Word not found.</p>";
        return;
      }

      const found = findEntry(input);
      if (found) {
        resultDiv.innerHTML = renderEntry(found.entry);
        if (!found.exact) {
          resultDiv.innerHTML = `<p style="color: orange;">Did you mean: "${found.entry.english}"?</p>` + resultDiv.innerHTML;
        }
        addToHistory(found.entry.english);
      } else {
        resultDiv.innerHTML = "<p>Dumbshit, Word not found.</p>";
      }
    }

    // Autocomplete
    const searchInput = document.getElementById("search");
    const suggestionsDiv = document.getElementById("suggestions");

    searchInput.addEventListener("input", () => {
      const query = searchInput.value.trim();
      suggestionsDiv.innerHTML = "";
      suggestionsDiv.style.display = "none";

      if (query.length < 2) return;

      const fuse = getFuse();
      let results = fuse.search(query);
      if (results.length > 0) {
        let html = "";
        for (let i = 0; i < Math.min(8, results.length); i++) {
          let word = results[i].item[document.getElementById('searchDirection').value === 'en-to-ol' ? 'english' : 'olonganes'];
          let highlighted = word.replace(new RegExp(query, 'gi'), match => `<span class="highlight">${match}</span>`);
          html += `<div class="suggestion-item" onclick="selectSuggestion('${word}')">${highlighted}</div>`;
        }
        suggestionsDiv.innerHTML = html;
        suggestionsDiv.style.display = "block";
      }
    });

    function selectSuggestion(word) {
      searchInput.value = word;
      suggestionsDiv.style.display = "none";
      searchWord();
    }

    document.addEventListener("click", e => {
      if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target) &&
          !document.getElementById('historyPanel').contains(e.target) &&
          !document.getElementById('bookmarkPanel').contains(e.target)) {
        suggestionsDiv.style.display = "none";
      }
    });

    // L·ªãch s·ª≠ t√¨m ki·∫øm
    let recentSearches = JSON.parse(localStorage.getItem('recentSearches')) || [];

    function addToHistory(word) {
      if (!word) return;
      if (recentSearches.length > 0 && recentSearches[0] === word) return;
      recentSearches.unshift(word);
      if (recentSearches.length > 20) recentSearches.pop();
      localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
    }

    function renderHistory() {
      const listDiv = document.getElementById('historyList');
      listDiv.innerHTML = '';
      if (recentSearches.length === 0) {
        listDiv.innerHTML = '<p>No recent searches yet.</p>';
        return;
      }
      recentSearches.forEach(word => {
        const item = document.createElement('div');
        item.className = 'history-item';
        item.textContent = word;
        item.onclick = () => {
          document.getElementById('search').value = word;
          searchWord();
          toggleHistory();
        };
        listDiv.appendChild(item);
      });
    }

    function clearHistory() {
      recentSearches = [];
      localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
      renderHistory();
    }

    function toggleHistory() {
      const panel = document.getElementById('historyPanel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
      if (panel.style.display === 'block') renderHistory();
    }

    // Bookmark
    let bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || [];

    function toggleBookmark(englishWord) {
      const entry = dictionary.find(w => w.english === englishWord);
      if (!entry) return;

      const index = bookmarks.findIndex(b => b.english === englishWord);
      if (index === -1) {
        bookmarks.unshift(entry);
        if (bookmarks.length > 50) bookmarks.pop();
      } else {
        bookmarks.splice(index, 1);
      }
      localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
      searchWord();
      if (document.getElementById('bookmarkPanel').style.display === 'block') renderBookmarks();
    }

    function renderBookmarks() {
      const listDiv = document.getElementById('bookmarkList');
      listDiv.innerHTML = '';
      if (bookmarks.length === 0) {
        listDiv.innerHTML = '<p>No bookmarks yet.</p>';
        return;
      }
      bookmarks.forEach(entry => {
        const item = document.createElement('div');
        item.className = 'bookmark-item';
        item.textContent = entry.english;
        item.onclick = () => {
          document.getElementById('search').value = entry.english;
          searchWord();
          toggleBookmarks();
        };
        listDiv.appendChild(item);
      });
    }

    function clearBookmarks() {
      bookmarks = [];
      localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
      renderBookmarks();
      searchWord();
    }

    function toggleBookmarks() {
      const panel = document.getElementById('bookmarkPanel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
      if (panel.style.display === 'block') renderBookmarks();
    }

    // Settings
    function toggleSettings() {
      const panel = document.getElementById("settingsPanel");
      panel.style.display = panel.style.display === "block" ? "none" : "block";
    }

    function setContrast(mode) {
      document.body.classList.remove("contrast-bow", "contrast-wob", "contrast-yob");
      document.body.classList.add(mode);
      localStorage.setItem("contrast", mode);
    }

    function setSize(size) {
      document.body.classList.remove("size-standard", "size-large", "size-xlarge");
      document.body.classList.add(size);
      localStorage.setItem("size", size);
    }

    window.addEventListener("load", async () => {
      const contrast = localStorage.getItem("contrast") || "contrast-bow";
      const size = localStorage.getItem("size") || "size-standard";
      setContrast(contrast);
      setSize(size);

      await loadDictionary(); // Load JSON ƒë·∫ßu ti√™n
    });

    searchInput.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        e.preventDefault();
        searchWord();
      }
    });

    document.getElementById('searchDirection').addEventListener('change', () => {
      suggestionsDiv.style.display = "none";
      searchInput.placeholder = document.getElementById('searchDirection').value === 'en-to-ol' ? "Enter English word..." : "Enter Olonganes word...";
    });
  </script>

</body>
</html>
